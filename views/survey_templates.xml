<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>
        <!-- Header -->
        <template id="survey_fill_header_custom" inherit_id="survey.survey_fill_header">
            <xpath expr="//div[@class='o_survey_nav pt16 mb-2']" position="replace">
                <div class="o_survey_nav pt16 mb-2">
                    <div class="container m-0 p-0">
                        <div class="row">
                            <div  class="col-lg-10">
                                <h3 t-if="answer.state == 'new' or survey.questions_layout != 'page_per_question'"
                                    t-esc="survey.title" class="o_survey_main_title pt-4"></h3>
                            </div>
                            <div class="o_survey_timer col-lg-2 pt-4">
                                <h3 class="o_survey_timer_container timer text-end">
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div t-att-class="'o_survey_breadcrumb_container mt8' + (' d-none ' if answer.state != 'in_progress' else '')"
                        t-if="not survey.has_conditional_questions and survey.questions_layout == 'page_per_section' and answer.state != 'done'"
                        t-att-data-can-go-back="survey.users_can_go_back"
                        t-att-data-pages="json.dumps(breadcrumb_pages)" />
                </div>
            </xpath>
        </template>

        <!-- Form with Questions (main page content) -->
        <template id="survey_fill_form_in_progress_custom" inherit_id="survey.survey_fill_form_in_progress">
            <xpath expr="." position="replace">
                <div class="o_survey_form_content_data d-none"
                    t-att-data-question-time-limit-reached="answer.question_time_limit_reached"
                    t-att-data-has-answered="bool(has_answered)"
                    t-att-data-is-page-description="bool(question and question.is_page and not is_html_empty(question.description))"
                    t-att-data-server-time="server_time"
                    t-att-data-timer="timer_start"
                    t-att-data-time-limit-minutes="time_limit_minutes"/>
                <t t-if="survey.questions_layout == 'one_page'">
                    <!-- Questions without section -->
                    <t t-foreach="survey.question_ids.filtered(lambda q: not q.page_id)" t-as="question">
                        <t t-if="question in answer.predefined_question_ids" t-call="survey.question_container"/>
                    </t>
                    <!-- Questions with section -->
                    <t t-foreach="survey.page_ids" t-as="page">
                        <t t-set="display_section" t-value="page.description or any(not q.triggering_answer_ids for q in page.question_ids)
                            or (survey.questions_selection == 'random' and page.question_ids and page.random_questions_count > 0)"/>
                        <div t-attf-class="js_section_wrapper #{'d-none' if not display_section else ''}">
                            <h3 t-field="page.title" class="o_survey_title pb16 text-break"/>
                            <div t-field="page.description" class="o_survey_description text-break"/>
                            <t t-foreach="page.question_ids" t-as="question">
                                <t t-if="question in answer.predefined_question_ids" t-call="survey.question_container"/>
                            </t>
                        </div>
                    </t>

                    <div class="text-center mt16 mb256">
                        <button type="submit" value="finish" class="btn btn-secondary disabled">Submit</button>
                        <button id="next_page" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} d-none">Next</button>
                        <span class="fw-bold text-muted ms-2 d-none d-md-inline">
                            <span id="enter-tooltip">or press CTRL+Enter</span>
                        </span>
                    </div>
                </t>

                <t t-if="survey.questions_layout == 'page_per_section'">
                    <h3 t-field='page.title' class="o_survey_title pb16 text-break" />
                    <div t-field='page.description' class="oe_no_empty text-break"/>

                    <input type="hidden" name="page_id" t-att-value="page.id" />
                    <t t-foreach='page.question_ids' t-as='question'>
                        <t t-if="question in answer.predefined_question_ids" t-call="survey.question_container"/>
                    </t>

                    <div class="row">
                        <div class="col-12 text-center mt16">
                            <t t-set="submit_value" t-value="'finish' if survey_last or answer.is_session_answer else 'next_skipped'
                                if answer.survey_first_submitted and skipped_questions.page_id and page in skipped_questions.page_id else 'next'"/>
                            <button type="submit" t-att-value="submit_value" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} disabled">
                                <t t-if="submit_value == 'finish'">Submit</t>
                                <t t-elif="submit_value == 'next_skipped'">Next Skipped</t>
                                <t t-else="">Continue</t>
                            </button>
                            <button id="next_page" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} d-none">Next</button>
                            <span class="fw-bold text-muted ms-2 d-none d-md-inline" id="enter-tooltip"> or press CTRL+Enter</span>
                        </div>
                    </div>
                </t>

                <!-- Minimized display means we display the choices vertically (instead of optimized based on screen space).
                An exception is made for options with images, where we always want to optimize screen space.-->
                <t t-set="minimized_display" t-value="survey.questions_layout == 'page_per_question' and not any(suggestion.value_image for suggestion in question.suggested_answer_ids)" />
                <div t-if="survey.questions_layout == 'page_per_question'"
                    t-attf-class="o_survey_page_per_question">
                    <input type="hidden" name="question_id" t-att-value="question.id" />
                    <!-- User has already answered for this session -->
                    <t t-if="answer.is_session_answer and (has_answered or answer.question_time_limit_reached)">
                        <div t-if="answer.question_time_limit_reached and not has_answered" class="fw-bold">Sorry, you have not been fast enough.</div>
                        <div t-else="" class="fw-bold">We have registered your answer! Please wait for the host to go to the next question.</div>
                        <fieldset disabled="disabled">
                            <t t-set="survey_form_readonly" t-value="True" />
                            <div class="mt-5">
                                <t t-call="survey.question_container" />
                            </div>
                        </fieldset>
                    </t>
                    <t t-elif="answer.is_session_answer and question.is_page and not is_html_empty(question.description)">
                        <div class="fw-bold mt-5">Pay attention to the host screen until the next question.</div>
                    </t>
                    <t t-else="">
                        <div class="mt-5">
                            <t t-call="survey.question_container"/>
                        </div>

                        <div class="row">
                            <div class="col-12 text-center mt16">
                                <t t-set="submit_value" t-value="'finish' if survey_last or answer.is_session_answer else
                                    'next_skipped' if answer.survey_first_submitted and skipped_questions and question in skipped_questions else 'next'"/>
                                <button type="submit" t-att-value="submit_value" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} disabled">
                                    <t t-if="submit_value == 'finish'">Submit</t>
                                    <t t-elif="submit_value == 'next_skipped'">Next Skipped</t>
                                    <t t-else="">Continue</t>
                                </button>
                                <button id="next_page" t-attf-class="btn #{'btn-secondary' if survey_last else 'btn-primary'} d-none">Next</button>
                                <span class="fw-bold text-muted ms-2 d-none d-md-inline">
                                    <span id="enter-tooltip">or press Enter</span>
                                </span>
                            </div>
                        </div>
                    </t>
                </div>
            </xpath>
        </template>

        <!-- Form Start (start form content) -->
        <template id="survey_fill_form_start_custom" inherit_id="survey.survey_fill_form_start">
            <xpath expr="//div[@class='wrap o_survey_start']" position="replace">
                <div class="wrap o_survey_start">
                    <div class='mb32'>
                        <div t-field='survey.description' class="oe_no_empty pb-5 text-break"/>
                        <t t-if="answer.is_session_answer">
                            <div class="fw-bold">
                                The session will begin automatically when the host starts.
                            </div>
                        </t>
                        <t t-else="">
                            <div t-if="survey.is_time_limited">
                                <p>
                                    <span t-if="not survey.certification">Time limit for this survey: </span>
                                    <span t-else="">Time limit for this certification: </span>
                                    <span class="fw-bold text-danger" t-field="survey.time_limit" t-options="{'widget': 'duration', 'unit': 'minute'}"></span>
                                </p>
                            </div>
                            <button type="submit" value="start" class="btn btn-lg disabled" style="background-color: #347cac;">
                                <t t-if="survey.certification">
                                    Start Certification
                                </t>
                                <t t-else="">
                                    Start Survey
                                </t>
                            </button>
                            <span class="o_survey_enter fw-bold text-muted ms-2 d-none d-md-inline">or press Enter</span>
                        </t>
                    </div>
                </div>
            </xpath>
        </template>

        <!-- Review Answer/Print -->
    </data>
</odoo>